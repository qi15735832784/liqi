# Linux 进程监控与压力测试

## 1. `top` 命令使用指南

`top` 命令用于实时监控系统性能和进程状态。

### 1.1 常用快捷键

- **信息显示**
	- `l`：切换负载均衡信息（Load Average）
	- `t`：切换任务与 CPU 状态
	- `m`：切换内存信息
	- `c`：显示完整命令行
	- `u` / `U`：按用户过滤进程（`u` 显示有效用户，`U` 显示任意用户）
- **进程管理**
	- `k`：终止进程
	- `r`：调整进程优先级（renice）
- **排序与筛选**
	- `f` / `F`：添加/删除/排序字段
	- `X`：增加固定宽度显示
	- `R`：反向排序
	- `H`：切换线程视图
	- `V`：切换树状视图（Forest View）
	- `x` / `y`：高亮排序字段 / 仅显示运行中的任务
	- `z` / `b`：切换颜色显示 / 加粗显示
- **调整刷新间隔与任务显示**
	- `d` 或 `s`：设置刷新间隔
	- `n` / `#`：设置最大任务显示数
	- `q`：退出 `top`

### 1.2 监控特定进程

```bash
top -p $(pgrep -d',' sshd)
```

## 2. `stress-ng` 压测工具

`stress-ng` 用于模拟高负载环境，测试 CPU、内存、IO 等资源。

### 2.1 安装 `stress-ng`

```bash
yum install epel-release -y
yum install stress-ng -y
```

或使用阿里云源：

```bash
https://developer.aliyun.com/mirror/epel
```

### 2.2 常见压力测试命令

```bash
stress-ng --cpu 8 --io 4 --vm 2 --vm-bytes 128M --fork 4 --timeout 10s
```

- `--cpu 8`：启动 8 个 CPU 计算任务
- `--io 4`：启动 4 个 IO 任务
- `--vm 2`：启动 2 个内存分配任务
- `--vm-bytes 128M`：每个内存任务使用 128MB
- `--fork 4`：启动 4 个子进程
- `--timeout 10s`：运行 10 秒后自动停止

## 3. 关键性能指标

- **CPU 负载**：使用 `top` 或 `htop` 观察 `%CPU`
- **内存占用**：`free -m` 或 `top` 查看 `Mem` 信息
- **IO 负载**：`iostat` 或 `iotop` 监测磁盘 IO

### **3.1. CPU 负载测试**

- **目标：**
	 测试 CPU 的计算能力和负载响应。通过模拟多个并发的计算任务，测试系统在高负载下的稳定性与响应时间。

- **参数示例：**

	```bash
	stress-ng --cpu 8 --timeout 10s
	```

	这里的 `--cpu 8` 启动 8 个 CPU 计算任务，测试多核 CPU 的并行处理能力。

- **关注点：**

	- CPU 使用率（`top` 或 `htop` 可查看）
	- 系统负载变化
	- 是否有任务延迟或崩溃

------

### **3.2. 内存占用测试**

- **目标：**
	 测试系统内存的分配与使用情况，特别是在高内存使用场景下的稳定性。模拟大量的内存分配和释放操作，观察系统如何处理内存瓶颈。

- **参数示例：**

	```bash
	stress-ng --vm 2 --vm-bytes 128M --timeout 10s
	```

	这里的 `--vm 2` 启动 2 个内存压力任务，`--vm-bytes 128M` 为每个任务分配 128MB 内存。

- **关注点：**

	- 内存使用情况（`free` 或 `top` 查看）
	- 交换空间（swap）的使用情况
	- 系统是否发生内存溢出或崩溃

------

### **3.3. 磁盘 I/O 测试**

- **目标：**
	 测试系统的磁盘 I/O 性能，尤其是在高并发读写操作下的表现。通过模拟大量磁盘读取和写入操作，测试磁盘性能和系统对 I/O 压力的应对能力。

- **参数示例：**

	```bash
	stress-ng --io 4 --timeout 10s
	```

	这里的 `--io 4` 启动 4 个磁盘 I/O 压力任务，模拟多个并发的磁盘访问操作。

- **关注点：**

	- 磁盘的读写速度
	- I/O 阻塞和延迟
	- 系统响应时间及稳定性

------

### **3.4. 综合测试**

- **目标：**
	 综合测试 CPU、内存和 I/O 三个方面的压力，模拟多任务并发运行的场景，测试系统的整体性能表现。

- **参数示例：**

	```bash
	stress-ng --cpu 8 --io 4 --vm 2 --vm-bytes 128M --fork 4 --timeout 10s
	```

	该命令将启动 8 个 CPU 任务、4 个 I/O 任务、2 个内存任务，进行多维度压力测试。

- **关注点：**

	- 综合系统负载
	- 不同资源之间的相互影响
	- 系统响应能力和稳定性



------

## **4. 相关资源**

- **EPEL 镜像（可用于安装 `stress-ng`）**
	 👉 [阿里云 EPEL 镜像](https://developer.aliyun.com/mirror/epel?spm=a2c6h.13651102.0.0.3e221b116aaplg)